# é¢è¯•å¤ä¹ äºŒï¼Œä¹‹å‰é‚£ä¸ªå¤ªé•¿äº†ï¼Œæ¢ä¸€ä¸ª

## å…³äºŽäº‹ä»¶å¾ªçŽ¯ï¼Œå®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡

+ å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡
  + å®ä»»åŠ¡é˜Ÿåˆ—(macrotask queue)ï¼šajaxã€setTimeoutã€setIntervalã€DOMç›‘å¬ã€UI Renderingç­‰ 
  + å¾®ä»»åŠ¡é˜Ÿåˆ—(microtasj queue): Promiseçš„thenå›žè°ƒã€ Mutation Observer APIã€queueMicrotask()ç­‰ 

+ é‚£ä¹ˆäº‹ä»¶å¾ªçŽ¯å¯¹äºŽä¸¤ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æ˜¯æ€Žä¹ˆæ ·çš„å‘¢ï¼Ÿ
  + 1.main scriptä¸­çš„ä»£ç ä¼˜å…ˆæ‰§è¡Œ(ç¼–å†™çš„é¡¶å±‚scriptä»£ç )
  + 2.åœ¨æ‰§è¡Œä»»ä½•ä¸€ä¸ªå®ä»»åŠ¡ä¹‹å‰ï¼ˆä¸æ˜¯é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼‰ï¼Œéƒ½ä¼šå…ˆæŸ¥çœ‹å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œ
    + ä¹Ÿå°±æ˜¯å®ä»»åŠ¡æ‰§è¡Œä¹‹å‰ï¼Œå¿…é¡»ä¿è¯å¾®ä»»åŠ¡é˜Ÿåˆ—æ˜¯ç©ºçš„
    + å¦‚æžœä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼˜å…ˆæ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼ˆå›žè°ƒï¼‰

## Nodeçš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡

+ æˆ‘ä»¬ä¼šå‘çŽ°ä»Žä¸€æ¬¡äº‹ä»¶å¾ªçŽ¯çš„Tickæ¥è¯´ï¼ŒNodeçš„äº‹ä»¶å¾ªçŽ¯æ›´å¤æ‚ï¼Œå®ƒä¹Ÿåˆ†ä¸ºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ï¼š
  + å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰ï¼šsetTimeoutã€setIntervalã€IOäº‹ä»¶ã€setImmediateã€closeäº‹ä»¶
  + å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ï¼šPromiseçš„thenå›žè°ƒã€process.nextTickã€queueMicrotask

+ ä½†æ˜¯ï¼ŒNodeä¸­çš„äº‹ä»¶å¾ªçŽ¯ä¸åªæ˜¯å¾®ä»»åŠ¡é˜Ÿåˆ—å’Œå®ä»»åŠ¡é˜Ÿåˆ—ï¼š
  + å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š
    + next tick queueï¼šprocess.nextTickï¼› 
    + other queueï¼šPromiseçš„thenå›žè°ƒã€queueMicrotaskï¼›
  + å®ä»»åŠ¡é˜Ÿåˆ—ï¼š
    + timer queueï¼šsetTimeoutã€setIntervalï¼›
    + poll queueï¼šIOäº‹ä»¶ï¼›
    + check queueï¼šsetImmediateï¼› 
    + close queueï¼šcloseäº‹ä»¶ï¼›

## Nodeäº‹ä»¶å¾ªçŽ¯çš„é¡ºåº

+ æ‰€ä»¥ï¼Œåœ¨æ¯ä¸€æ¬¡äº‹ä»¶å¾ªçŽ¯çš„tickä¸­ï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹é¡ºåºæ¥æ‰§è¡Œä»£ç ï¼š
  + next tick microtask queue:process.nextTickï¼› 
  + other microtask queue:Promiseçš„thenå›žè°ƒã€queueMicrotaskï¼›
  + timer queueï¼›
  + poll queueï¼›
  + check queueï¼› 
  + close queueï¼›

+ await æŸå‡½æ•°()ä¹‹åŽçš„è¯­å¥ä¼šè¢«æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œ

  ```js
  async function async1() {
    console.log('async1 start')
    await async2()
    // è¿™é‡Œä¹‹åŽçš„console.log('async1 end')ä¼šè¢«æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
    console.log('async1 end')
  }
  
  async function async2() {
    // ç›¸å½“äºŽreturn undefined,å³Promise.resolve(undefined)
    console.log('async2')
  }
  ```

+ return 4ç›¸å½“äºŽresolve(4)ï¼Œè€Œresolve(4)ç›¸å½“äºŽåœ¨ä¹‹åŽçš„thenä¸­çš„resçš„å€¼å³ä¸º4ï¼Œè¿™é‡ŒresæŒ‡çš„æ˜¯å½¢å‚é¢åç§°ï¼Œä½ å¯ä»¥èµ·ä»»ä½•å€¼

  ```js
  Promise.resolve()
    .then(() => {
      console.log(0)
      // 1.ç›´æŽ¥returnä¸€ä¸ªå€¼ ç›¸å½“äºŽresolve(4)
      // return 4
  
      // 2.return thenableçš„å€¼
      return {
        then: function (resolve) {
          // å¤§é‡çš„è®¡ç®—
          resolve(4)
        },
      }
  
      // 3.return Promise
      // ä¸æ˜¯æ™®é€šçš„å€¼, å¤šåŠ ä¸€æ¬¡å¾®ä»»åŠ¡
      // Promise.resolve(4), å¤šåŠ ä¸€æ¬¡å¾®ä»»åŠ¡
      // ä¸€å…±å¤šåŠ ä¸¤æ¬¡å¾®ä»»åŠ¡
      return Promise.resolve(4)
    })
    .then((res) => {
    	// å‰é¢çš„return 4ç›¸å½“äºŽresolve(4)ï¼Œè¿™é‡Œçš„reså³ä¸º4
      console.log(res)
    })
  
  
  setTimeout(() => console.log(0));
  new Promise((resolve) => {
    console.log(1);
    resolve(2);
    console.log(3);
    //ä¸Šé¢resolve(2)ï¼Œç›¸å½“äºŽä¸‹é¢ðŸ‘‡ðŸ»çš„o = 2
  }).then((o) => console.log(o));
  
  new Promise((resolve) => {
    console.log(4);
    resolve(5);
    //è¿™é‡Œresolve(5)ï¼Œç›¸å½“äºŽä¸‹é¢ðŸ‘‡ðŸ»çš„o = 5
  })
    .then((o) => console.log(o))
    .then(() => console.log(6));
  
  // answer:1 => 3 => 4 => 2 => 5 => 6 => 0
  ```

  